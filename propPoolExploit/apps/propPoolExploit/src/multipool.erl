-module(multipool).
-export([test/0]).

%amoveopool() -> {{176,9,84,75}, 8080}.
amoveopool() -> "http://176.9.84.75:8080".
test() ->
    Data = <<"[\"height\"]">>,
    talker(Data, amoveopool(), 1).

talk_helper2(Data, Peer) ->
    httpc:request(post, {Peer, [], "application/octet-stream", iolist_to_binary(Data)}, [{timeout, 3000}], []).
talker(_Data, _Peer, 0) -> throw("talk helper failed");
talker(Data, Peer, N) ->
    case talk_helper2(Data, Peer) of
        {ok, {_Status, _Headers, []}} ->
            io:fwrite("server gave confusing response\n"),
            talker(Data, Peer, N-1);
        {ok, {_, _, R}} -> R;
        %{error, _} ->
        E -> 
            io:fwrite("\nIf you are running a solo-mining node, then this error may have happened because you need to turn on and sync your Amoveo node before you can mine. You can get it here: https://github.com/zack-bitcoin/amoveo \n If this error happens while connected to the public mining node, then it can probably be safely ignored."),
             talker(Data, Peer, N-1)
    end.
